# æˆå‘˜ç®¡ç†åç«¯ç³»ç»Ÿ

## æ¦‚è¿°

è¿™æ˜¯ä¸€ä¸ªå®Œæ•´çš„æˆå‘˜ç®¡ç†åç«¯ç³»ç»Ÿï¼Œä½¿ç”¨ Node.js + Express æ„å»ºï¼Œæä¾›äº†ç”¨æˆ·ç®¡ç†ã€è§’è‰²ç®¡ç†ã€éƒ¨é—¨ç®¡ç†ã€æƒé™ç®¡ç†ç­‰å®Œæ•´çš„æˆå‘˜ç®¡ç†åŠŸèƒ½ã€‚

## åŠŸèƒ½ç‰¹æ€§

### ğŸ¯ æ ¸å¿ƒåŠŸèƒ½

1. **ç”¨æˆ·æƒé™ç®¡ç†**
   - ç”¨æˆ·ä¿¡æ¯ç®¡ç†ï¼ˆå¢åˆ æ”¹æŸ¥ï¼‰
   - è§’è‰²åˆ†é…å’Œæƒé™æ§åˆ¶
   - ç”¨æˆ·çŠ¶æ€ç®¡ç†ï¼ˆæ¿€æ´»/ç¦ç”¨/å¾…æ¿€æ´»ï¼‰
   - ç”¨æˆ·æœç´¢å’Œç­›é€‰

2. **è§’è‰²ç®¡ç†**
   - è§’è‰²åˆ›å»ºã€ç¼–è¾‘ã€åˆ é™¤
   - è§’è‰²æƒé™é…ç½®
   - è§’è‰²ç­‰çº§ç®¡ç†
   - è§’è‰²ä½¿ç”¨ç»Ÿè®¡

3. **éƒ¨é—¨ç®¡ç†**
   - éƒ¨é—¨å±‚çº§ç®¡ç†
   - éƒ¨é—¨ä¿¡æ¯ç»´æŠ¤
   - éƒ¨é—¨æˆå‘˜ç»Ÿè®¡
   - éƒ¨é—¨å…³ç³»ç®¡ç†

4. **æƒé™ç®¡ç†**
   - æƒé™æ ‘å½¢ç»“æ„
   - ç»†ç²’åº¦æƒé™æ§åˆ¶
   - æƒé™ç»§æ‰¿æœºåˆ¶
   - æƒé™éªŒè¯ä¸­é—´ä»¶

5. **ç»„ç»‡æ¶æ„**
   - ç»„ç»‡æ¶æ„æ ‘å½¢å±•ç¤º
   - æ±‡æŠ¥å…³ç³»ç®¡ç†
   - éƒ¨é—¨å±‚çº§å…³ç³»
   - ç»„ç»‡æ¶æ„å¯è§†åŒ–

### ğŸ”§ æŠ€æœ¯ç‰¹æ€§

- **RESTful API è®¾è®¡**
- **JWT èº«ä»½è®¤è¯**
- **æ•°æ®éªŒè¯å’Œé”™è¯¯å¤„ç†**
- **åˆ†é¡µå’Œæœç´¢åŠŸèƒ½**
- **æƒé™æ§åˆ¶ä¸­é—´ä»¶**
- **ä¸šåŠ¡é€»è¾‘æœåŠ¡å±‚**
- **å®Œæ•´çš„APIæ–‡æ¡£**

## é¡¹ç›®ç»“æ„

```
backend/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ data/
â”‚   â”‚   â””â”€â”€ memberData.js          # æ•°æ®æ¨¡å‹å’Œæ¨¡æ‹Ÿæ•°æ®
â”‚   â”œâ”€â”€ middleware/
â”‚   â”‚   â””â”€â”€ auth.js                # è®¤è¯å’Œæƒé™ä¸­é—´ä»¶
â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â””â”€â”€ members.js             # æˆå‘˜ç®¡ç†APIè·¯ç”±
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â””â”€â”€ memberService.js       # ä¸šåŠ¡é€»è¾‘æœåŠ¡å±‚
â”‚   â””â”€â”€ app.js                     # ä¸»åº”ç”¨æ–‡ä»¶
â”œâ”€â”€ test-members-api.js            # APIæµ‹è¯•è„šæœ¬
â”œâ”€â”€ MEMBER_MANAGEMENT_API.md       # APIæ–‡æ¡£
â””â”€â”€ MEMBER_MANAGEMENT_README.md    # é¡¹ç›®è¯´æ˜
```

## å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–

```bash
cd backend
npm install
```

### 2. ç¯å¢ƒé…ç½®

åˆ›å»º `.env` æ–‡ä»¶ï¼š

```env
NODE_ENV=development
PORT=3001
JWT_SECRET=your-jwt-secret-key
CORS_ORIGIN=http://localhost:5173
RATE_LIMIT_WINDOW_MS=900000
RATE_LIMIT_MAX_REQUESTS=100
```

### 3. å¯åŠ¨æœåŠ¡å™¨

```bash
# å¼€å‘æ¨¡å¼
npm run dev

# ç”Ÿäº§æ¨¡å¼
npm start
```

### 4. æµ‹è¯•API

```bash
# è¿è¡Œæµ‹è¯•è„šæœ¬
node test-members-api.js
```

## API æ¥å£

### åŸºç¡€ä¿¡æ¯

- **åŸºç¡€URL**: `http://localhost:3001/api/members`
- **è®¤è¯æ–¹å¼**: Bearer Token (JWT)
- **æ•°æ®æ ¼å¼**: JSON

### ä¸»è¦æ¥å£

#### ç”¨æˆ·ç®¡ç†
- `GET /users` - è·å–ç”¨æˆ·åˆ—è¡¨
- `GET /users/:id` - è·å–ç”¨æˆ·è¯¦æƒ…
- `POST /users` - åˆ›å»ºç”¨æˆ·
- `PUT /users/:id` - æ›´æ–°ç”¨æˆ·
- `DELETE /users/:id` - åˆ é™¤ç”¨æˆ·

#### è§’è‰²ç®¡ç†
- `GET /roles` - è·å–è§’è‰²åˆ—è¡¨
- `GET /roles/:id` - è·å–è§’è‰²è¯¦æƒ…
- `POST /roles` - åˆ›å»ºè§’è‰²
- `PUT /roles/:id` - æ›´æ–°è§’è‰²
- `DELETE /roles/:id` - åˆ é™¤è§’è‰²

#### éƒ¨é—¨ç®¡ç†
- `GET /departments` - è·å–éƒ¨é—¨åˆ—è¡¨
- `GET /departments/:id` - è·å–éƒ¨é—¨è¯¦æƒ…
- `POST /departments` - åˆ›å»ºéƒ¨é—¨
- `PUT /departments/:id` - æ›´æ–°éƒ¨é—¨
- `DELETE /departments/:id` - åˆ é™¤éƒ¨é—¨

#### æƒé™ç®¡ç†
- `GET /permissions` - è·å–æƒé™åˆ—è¡¨
- `GET /permissions/tree` - è·å–æƒé™æ ‘

#### ç»„ç»‡æ¶æ„
- `GET /organization/tree` - è·å–ç»„ç»‡æ¶æ„æ ‘
- `GET /organization/reports` - è·å–æ±‡æŠ¥å…³ç³»

#### ç»Ÿè®¡ä¿¡æ¯
- `GET /statistics` - è·å–ç»Ÿè®¡ä¿¡æ¯

## æ•°æ®æ¨¡å‹

### ç”¨æˆ·æ¨¡å‹ (UserInfo)

```javascript
{
  id: string,              // ç”¨æˆ·ID
  employeeId: string,      // å·¥å·
  name: string,            // å§“å
  email: string,           // é‚®ç®±
  phone: string,           // æ‰‹æœºå·
  department: string,      // éƒ¨é—¨åç§°
  position: string,        // èŒä½
  role: string,            // è§’è‰²åç§°
  permissions: string[],   // æƒé™åˆ—è¡¨
  status: string,          // çŠ¶æ€ (active/pending/disabled)
  lastLogin: string,       // æœ€åç™»å½•æ—¶é—´
  reportTo: string,        // æ±‡æŠ¥å¯¹è±¡
  joinDate: string         // å…¥èŒæ—¥æœŸ
}
```

### è§’è‰²æ¨¡å‹ (RoleInfo)

```javascript
{
  id: string,              // è§’è‰²ID
  name: string,            // è§’è‰²åç§°
  code: string,            // è§’è‰²ä»£ç 
  description: string,     // è§’è‰²æè¿°
  permissions: string[],   // æƒé™åˆ—è¡¨
  level: number,           // è§’è‰²ç­‰çº§
  status: string,          // çŠ¶æ€ (active/disabled)
  userCount: number,       // ç”¨æˆ·æ•°é‡
  createDate: string       // åˆ›å»ºæ—¶é—´
}
```

### éƒ¨é—¨æ¨¡å‹ (DepartmentInfo)

```javascript
{
  id: string,              // éƒ¨é—¨ID
  name: string,            // éƒ¨é—¨åç§°
  code: string,            // éƒ¨é—¨ä»£ç 
  description: string,     // éƒ¨é—¨æè¿°
  parentId: string,        // ä¸Šçº§éƒ¨é—¨ID
  manager: string,         // è´Ÿè´£äºº
  memberCount: number,     // æˆå‘˜æ•°é‡
  level: number,           // éƒ¨é—¨å±‚çº§
  status: string,          // çŠ¶æ€ (active/disabled)
  createDate: string       // åˆ›å»ºæ—¶é—´
}
```

## æƒé™ç³»ç»Ÿ

### æƒé™ç±»å‹

1. **èœå•æƒé™**: æ§åˆ¶é¡µé¢è®¿é—®
2. **æŒ‰é’®æƒé™**: æ§åˆ¶åŠŸèƒ½æ“ä½œ
3. **æ¥å£æƒé™**: æ§åˆ¶APIè®¿é—®

### æƒé™éªŒè¯

ç³»ç»Ÿä½¿ç”¨ä¸­é—´ä»¶è¿›è¡Œæƒé™éªŒè¯ï¼š

```javascript
// æ£€æŸ¥ç‰¹å®šæƒé™
app.use('/api/members/users', checkPermission('user.read'));

// æ£€æŸ¥ç®¡ç†å‘˜æƒé™
app.use('/api/members/roles', requireAdmin);

// æ£€æŸ¥éƒ¨é—¨æƒé™
app.use('/api/members/departments', checkDepartmentAccess);
```

### æƒé™ç»§æ‰¿

- è¶…çº§ç®¡ç†å‘˜æ‹¥æœ‰æ‰€æœ‰æƒé™ (`*`)
- è§’è‰²æƒé™å¯ä»¥ç»§æ‰¿ç»™ç”¨æˆ·
- éƒ¨é—¨ç®¡ç†å‘˜å¯ä»¥ç®¡ç†æœ¬éƒ¨é—¨ç”¨æˆ·

## ä¸­é—´ä»¶

### è®¤è¯ä¸­é—´ä»¶

- `authenticateToken`: JWTä»¤ç‰ŒéªŒè¯
- `authorize`: è§’è‰²æƒé™éªŒè¯
- `checkPermission`: å…·ä½“æƒé™éªŒè¯
- `requireAdmin`: ç®¡ç†å‘˜æƒé™éªŒè¯
- `checkDepartmentAccess`: éƒ¨é—¨æƒé™éªŒè¯

### å…¶ä»–ä¸­é—´ä»¶

- `validateRequest`: è¯·æ±‚å‚æ•°éªŒè¯
- `errorHandler`: é”™è¯¯å¤„ç†
- `requestLogger`: è¯·æ±‚æ—¥å¿—

## ä¸šåŠ¡é€»è¾‘

### æœåŠ¡å±‚ (MemberService)

æä¾›å®Œæ•´çš„ä¸šåŠ¡é€»è¾‘å¤„ç†ï¼š

- æ•°æ®éªŒè¯å’Œä¸šåŠ¡è§„åˆ™
- å…³è”æ•°æ®æ›´æ–°
- ç»Ÿè®¡ä¿¡æ¯è®¡ç®—
- æƒé™ç»§æ‰¿å¤„ç†

### æ•°æ®æ“ä½œ

- æ”¯æŒåˆ†é¡µæŸ¥è¯¢
- æ”¯æŒå¤šæ¡ä»¶ç­›é€‰
- æ”¯æŒæœç´¢åŠŸèƒ½
- æ•°æ®å…³è”æ›´æ–°

## é”™è¯¯å¤„ç†

### ç»Ÿä¸€é”™è¯¯æ ¼å¼

```json
{
  "success": false,
  "message": "é”™è¯¯æè¿°",
  "code": 400,
  "errors": "è¯¦ç»†é”™è¯¯ä¿¡æ¯"
}
```

### å¸¸è§é”™è¯¯ç 

- `400`: è¯·æ±‚å‚æ•°é”™è¯¯
- `401`: æœªè®¤è¯
- `403`: æƒé™ä¸è¶³
- `404`: èµ„æºä¸å­˜åœ¨
- `409`: èµ„æºå†²çª
- `500`: æœåŠ¡å™¨é”™è¯¯

## æµ‹è¯•

### è¿è¡Œæµ‹è¯•

```bash
# åŸºç¡€APIæµ‹è¯•
node test-members-api.js

# ä½¿ç”¨Jestè¿›è¡Œå•å…ƒæµ‹è¯•
npm test
```

### æµ‹è¯•è¦†ç›–

- APIæ¥å£æµ‹è¯•
- æ•°æ®éªŒè¯æµ‹è¯•
- æƒé™éªŒè¯æµ‹è¯•
- é”™è¯¯å¤„ç†æµ‹è¯•

## éƒ¨ç½²

### ç”Ÿäº§ç¯å¢ƒé…ç½®

```bash
# è®¾ç½®ç¯å¢ƒå˜é‡
export NODE_ENV=production
export PORT=3001
export JWT_SECRET=your-production-secret

# å¯åŠ¨æœåŠ¡
npm start
```

### Docker éƒ¨ç½²

```dockerfile
FROM node:18-alpine
WORKDIR /app
COPY package*.json ./
RUN npm ci --only=production
COPY . .
EXPOSE 3001
CMD ["npm", "start"]
```

## æ‰©å±•åŠŸèƒ½

### å¯æ‰©å±•çš„åŠŸèƒ½

1. **æ•°æ®åº“é›†æˆ**: æ›¿æ¢å†…å­˜æ•°æ®ä¸ºçœŸå®æ•°æ®åº“
2. **æ–‡ä»¶ä¸Šä¼ **: æ”¯æŒç”¨æˆ·å¤´åƒä¸Šä¼ 
3. **é‚®ä»¶é€šçŸ¥**: ç”¨æˆ·åˆ›å»ºå’ŒçŠ¶æ€å˜æ›´é€šçŸ¥
4. **æ“ä½œæ—¥å¿—**: è®°å½•æ‰€æœ‰æ“ä½œå†å²
5. **æ•°æ®å¯¼å…¥å¯¼å‡º**: æ”¯æŒExcelå¯¼å…¥å¯¼å‡º
6. **å•ç‚¹ç™»å½•**: é›†æˆSSOç³»ç»Ÿ

### æ€§èƒ½ä¼˜åŒ–

1. **ç¼“å­˜æœºåˆ¶**: Redisç¼“å­˜çƒ­ç‚¹æ•°æ®
2. **æ•°æ®åº“ä¼˜åŒ–**: ç´¢å¼•ä¼˜åŒ–å’ŒæŸ¥è¯¢ä¼˜åŒ–
3. **åˆ†é¡µä¼˜åŒ–**: æ¸¸æ ‡åˆ†é¡µå’Œè™šæ‹Ÿæ»šåŠ¨
4. **CDNåŠ é€Ÿ**: é™æ€èµ„æºCDNåˆ†å‘

## å®‰å…¨è€ƒè™‘

1. **è¾“å…¥éªŒè¯**: æ‰€æœ‰è¾“å…¥éƒ½ç»è¿‡ä¸¥æ ¼éªŒè¯
2. **SQLæ³¨å…¥é˜²æŠ¤**: ä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢
3. **XSSé˜²æŠ¤**: è¾“å‡ºè½¬ä¹‰å’ŒCSPç­–ç•¥
4. **CSRFé˜²æŠ¤**: CSRFä»¤ç‰ŒéªŒè¯
5. **é™æµä¿æŠ¤**: APIè¯·æ±‚é¢‘ç‡é™åˆ¶
6. **æ—¥å¿—å®¡è®¡**: å®Œæ•´çš„æ“ä½œæ—¥å¿—è®°å½•

## è´¡çŒ®æŒ‡å—

1. Fork é¡¹ç›®
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯
3. æäº¤ä»£ç 
4. åˆ›å»º Pull Request

## è®¸å¯è¯

MIT License

## è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·é€šè¿‡ä»¥ä¸‹æ–¹å¼è”ç³»ï¼š

- é‚®ç®±: support@company.com
- é¡¹ç›®åœ°å€: https://github.com/company/member-management
